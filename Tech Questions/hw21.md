# HW21
____
### 7. Explain why Cassandra has a "Query-first design" with CQL query examples
Cassandra follows a query-first design approach, meaning that schema design is driven by the queries you need to execute, rather than traditional relational database normalization.  
Example: For a E-Commerce Order System, we want to get a user's latest orders quickly.
```cassandraql
SELECT * FROM user_orders WHERE user_id = ? LIMIT 10;
```
In this case, we would create a table with a partition key of `user_id` and a clustering key of `order_id` to allow for fast retrieval of the latest orders for a user.
```cassandraql
CREATE TABLE user_orders (
    user_id UUID,
    order_id UUID,
    order_timestamp TIMESTAMP,
    product_id UUID,
    quantity INT,
    total_price DECIMAL,
    PRIMARY KEY (user_id, order_timestamp)
) WITH CLUSTERING ORDER BY (order_timestamp DESC);
```

### 8. Explain Cassandra consistency levels.
Cassandra follows the CAP theorem, allowing users to tune Consistency, Availability, and Partition Tolerance.  
Consistency levels in Cassandra define how many replicas must acknowledge a read or write request before it is considered successful.  
- **ANY**: At least one node required, fastest but weakest consistency
- **ONE**: At least one replica required
- **TWO**: At least two replicas required
- **THREE**: At least three replicas required
- **QUORUM**: Majority of replicas required
- **ALL**: All replicas required, slowest but strongest consistency

### 9. Attached code and screenshots for above questions.
```cassandraql
// create a new keyspace "chuwa"
CREATE KEYSPACE chuwa
WITH REPLICATION = {'class': 'SimpleStrategy', 'replication_factor': 3};

USE chuwa;

// create a new table "trainee_information" with necessary columns, setup multiple partition keys, 
// setup a clustering key column using timestamp data type
CREATE TABLE trainee_information (
    trainee_id UUID,
    first_name TEXT,
    last_name TEXT,
    email TEXT,
    department TEXT,
    enrollment_year INT,
    enrollment_date TIMESTAMP,
    PRIMARY KEY((department, enrollment_year), enrollment_date, trainee_id)
) WITH CLUSTERING ORDER BY (enrollment_date DESC);

// Insert multiple rows for above table.
INSERT INTO trainee_information (trainee_id, first_name, last_name, email, department, enrollment_year, enrollment_date)
VALUES (uuid(), 'Jiajun', 'Li', 'ljj@gmail.com', 'backend', 2025, '2025-01-01 00:00:00');
INSERT INTO trainee_information (trainee_id, first_name, last_name, email, department, enrollment_year, enrollment_date)
VALUES (uuid(), 'Jiahui', 'Wang', 'wjh@gmail.com', 'backend', 2024, '2024-01-02 00:00:00');
INSERT INTO trainee_information (trainee_id, first_name, last_name, email, department, enrollment_year, enrollment_date)
VALUES (uuid(), 'Jiahao', 'Chen', 'cjh@outlook.com', 'frontend', 2023, '2023-01-03 00:00:00');

// Flexible schema: adding columns dynamically without affecting existing records
ALTER TABLE trainee_information ADD phone_number TEXT;
// Then insert a new record with the new column
INSERT INTO trainee_information (trainee_id, first_name, last_name, email, department, enrollment_year, enrollment_date, phone_number)
VALUES (uuid(), 'Jiaxin', 'Zhang', 'zjx@qq.com', 'frontend', 2022, '2022-01-04 00:00:00', '2179892039');
```





